# https://taskfile.dev

version: '3'


tasks:
  internal-deploy:
    internal: true
    prompt: Do you want to deploy this derivation? This will also `git add -A` and commit.
    dir: ./config
    cmds:
      - git add -A
      - git commit -m "Deploy"
      # bootstrap: - sudo nix --extra-experimental-features nix-command --extra-experimental-features flakes run nix-darwin/nix-darwin-25.05#darwin-rebuild -- switch --flake .
      - cmd: sudo darwin-rebuild switch --flake .
        platforms: [darwin]
      - cmd: sudo darwin-rebuild switch --flake .
        platforms: [linux/amd64]
      - cmd: rm result
        silent: true
      - git show --pretty="" --name-only HEAD
  diff:
    cmds:
      - ./diff.sh  
  deploy:
    cmds:
      - task: diff
      - task: internal-deploy
